(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8108],{13022:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var a=s(95155),r=s(12115),l=s(35695),d=s(389),i=s(41784),n=s(44829),c=s(30285),o=s(66695),m=s(3638),h=s(50172),u=s(51920),x=s(23422),f=s(14636),p=s(85511),y=s(59434),j=s(85057),g=s(35317),N=s(56104),w=s(27600),D=s(30241);function b(){let{user:e}=(0,w.A)(),t=(0,l.useSearchParams)(),s=t.get("id"),b=t.get("from"),P=t.get("to"),[L,v]=r.useState(),[E,S]=r.useState(),[F,G]=r.useState(),[M,A]=r.useState(null),[k,T]=r.useState(!0),[C,B]=r.useState(!0),[R,Z]=r.useState([]),[_,W]=r.useState(null),Y=!!s,J=!!b&&!!P;r.useEffect(()=>{if(J&&b&&P)try{let e=(0,d.qg)(b,"yyyy-MM-dd",new Date),t=(0,d.qg)(P,"yyyy-MM-dd",new Date);v(e),S(t);let s=(0,D.he)(e.getFullYear()).find(t=>t.start.getTime()===e.getTime());s&&G(s.payDate)}catch(e){console.error("Error parsing dates from URL",e)}},[b,P,J]),r.useEffect(()=>{if(J||!e)return void B(!1);(async()=>{B(!0);try{let t=(0,g.rJ)(N.db,"users",e.uid,"payrolls"),s=(0,g.P)(t,(0,g.My)("toDate","desc")),a=await (0,g.GG)(s),r=a.docs.map(e=>{let t=e.data(),[s,a,r]=t.fromDate.split("-").map(Number),[l,d,i]=t.toDate.split("-").map(Number);return{from:new Date(s,a-1,r),to:new Date(l,d-1,i)}});if(Z(r),a.empty){if(!Y){let e=new Date,t=(0,D.he)(e.getFullYear()),s=t.find(t=>e>=t.start&&e<=t.end)||t.find(t=>e<t.start);s&&(v(s.start),S(s.end),G(s.payDate))}}else{let e=a.docs[0].data(),[t,s,r]=e.fromDate.split("-").map(Number),[l,d,n]=e.toDate.split("-").map(Number),c=new Date(t,s-1,r),o=new Date(l,d-1,n);if(W("".concat((0,i.GP)(c,"LLL dd, y")," - ").concat((0,i.GP)(o,"LLL dd, y"))),!Y){let e=(0,D.he)(o.getFullYear()).find(e=>e.start>o);if(e)v(e.start),S(e.end),G(e.payDate);else{let e=(0,D.he)(o.getFullYear()+1);e.length>0&&(v(e[0].start),S(e[0].end),G(e[0].payDate))}}}}catch(e){console.error("Error fetching payroll data:",e)}finally{B(!1)}})()},[e,Y,J]),r.useEffect(()=>{if(s&&e){T(!0);let t=(0,g.H9)(N.db,"users",e.uid,"payrolls",s);(0,g.x7)(t).then(e=>{if(e.exists()){let t={id:e.id,...e.data()};A(t);let[s,a,r]=t.fromDate.split("-").map(Number),[l,d,i]=t.toDate.split("-").map(Number);v(new Date(s,a-1,r)),S(new Date(l,d-1,i));let n=(0,D.he)(new Date(s,a-1,r).getFullYear()).find(e=>e.start.getTime()===new Date(s,a-1,r).getTime());n&&G(n.payDate)}else console.error("No such payroll document!")}).catch(e=>{console.error("Error fetching payroll:",e)}).finally(()=>{T(!1)})}else T(!1)},[s,e]);let q=e=>{if(Y||J)return!1;for(let t of R)if(e>=t.from&&e<=t.to)return!0;return!1},O=Y||J;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:Y?"Edit Payroll":"Run New Payroll"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:Y?"Editing payroll for period: ".concat(M&&L&&E?(0,i.GP)(L,"LLL dd, y")+" - "+(0,i.GP)(E,"LLL dd, y"):"..."):"Calculate employee payroll for a specific period."})]}),!Y&&_&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium flex items-center text-muted-foreground",children:[(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Last Payroll Run"]}),(0,a.jsx)("p",{className:"text-sm font-semibold",children:_})]})]}),k||C?(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Loading Payroll Data..."})}),(0,a.jsx)(o.Wu,{children:(0,a.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,a.jsx)(h.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsxs)(o.aR,{children:[(0,a.jsx)(o.ZB,{children:"1. Pay Period"}),(0,a.jsx)(o.BT,{children:O?"The pay period for this run is locked.":"Choose the date range for this payroll run. Previously used dates are disabled."})]}),(0,a.jsx)(o.Wu,{children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex items-end gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"from-date",children:"From"}),(0,a.jsxs)(f.AM,{children:[(0,a.jsx)(f.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{id:"from-date",variant:"outline",className:(0,y.cn)("w-[240px] justify-start text-left font-normal",!L&&"text-muted-foreground"),disabled:O,children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),L?(0,i.GP)(L,"LLL dd, y"):(0,a.jsx)("span",{children:"Pick a start date"})]})}),(0,a.jsx)(f.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(p.V,{mode:"single",selected:L,onSelect:v,disabled:e=>E&&e>E||e>new Date||O||q(e),initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"to-date",children:"To"}),(0,a.jsxs)(f.AM,{children:[(0,a.jsx)(f.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{id:"to-date",variant:"outline",className:(0,y.cn)("w-[240px] justify-start text-left font-normal",!E&&"text-muted-foreground"),disabled:O,children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),E?(0,i.GP)(E,"LLL dd, y"):(0,a.jsx)("span",{children:"Pick an end date"})]})}),(0,a.jsx)(f.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(p.V,{mode:"single",selected:E,onSelect:S,disabled:e=>!L||e<L||e>new Date||O||q(e),initialFocus:!0})})]})]})]}),F&&(0,a.jsxs)("div",{className:"border-l-4 border-primary pl-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Pay Date"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-primary",children:(0,i.GP)(F,"LLL dd, yyyy")})]})]})})]}),L&&E?(0,a.jsx)(n.B,{from:L,to:E,payrollId:s,initialPayrollData:M},s||"".concat((0,i.GP)(L,"yyyy-MM-dd"),"-").concat((0,i.GP)(E,"yyyy-MM-dd"))):(0,a.jsxs)(o.Zp,{children:[(0,a.jsxs)(o.aR,{children:[(0,a.jsxs)(o.ZB,{className:"flex items-center",children:[(0,a.jsx)(x.A,{className:"mr-2 h-5 w-5 text-muted-foreground"})," 2. Calculate Payroll"]}),(0,a.jsx)(o.BT,{children:"Enter hours for each employee for the selected pay period."})]}),(0,a.jsx)(o.Wu,{children:(0,a.jsx)("p",{className:"text-center text-muted-foreground py-10",children:"Please select a pay period above to begin."})})]})]})]})}function P(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsx)(h.A,{className:"h-8 w-8 animate-spin"})}),children:(0,a.jsx)(b,{})})}},66167:(e,t,s)=>{Promise.resolve().then(s.bind(s,13022))}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7416,3796,3873,1784,5740,1345,5521,4480,9155,1207,394,9699,8441,1684,7358],()=>t(66167)),_N_E=e.O()}]);