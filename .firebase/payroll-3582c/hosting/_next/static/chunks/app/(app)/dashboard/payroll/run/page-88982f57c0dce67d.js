(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{285:(e,t,a)=>{"use strict";a.d(t,{$:()=>i,r:()=>d});var r=a(5155),s=a(2115),l=a(9708),n=a(2085),o=a(9434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:i=!1,...c}=e,u=i?l.DX:"button";return(0,r.jsx)(u,{className:(0,o.cn)(d({variant:s,size:n,className:a})),ref:t,...c})});i.displayName="Button"},2346:(e,t,a)=>{"use strict";a.d(t,{w:()=>o});var r=a(5155),s=a(2115),l=a(7489),n=a(9434);let o=s.forwardRef((e,t)=>{let{className:a,orientation:s="horizontal",decorative:o=!0,...d}=e;return(0,r.jsx)(l.b,{ref:t,decorative:o,orientation:s,className:(0,n.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",a),...d})});o.displayName=l.b.displayName},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var r=a(5155),s=a(2115),l=a(9434);let n=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,r.jsx)("input",{type:s,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","print:shadow-none print:border-gray-400 print:h-8",a),ref:t,...n})});n.displayName="Input"},5057:(e,t,a)=>{"use strict";a.d(t,{J:()=>i});var r=a(5155),s=a(2115),l=a(968),n=a(2085),o=a(9434);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,o.cn)(d(),a),...s})});i.displayName=l.b.displayName},5127:(e,t,a)=>{"use strict";a.d(t,{A0:()=>o,BF:()=>d,Hj:()=>i,XI:()=>n,nA:()=>u,nd:()=>c,r6:()=>m});var r=a(5155),s=a(2115),l=a(9434);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",a),...s})})});n.displayName="Table";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",a),...s})});o.displayName="TableHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",a),...s})});d.displayName="TableBody",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s})}).displayName="TableFooter";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s})});i.displayName="TableRow";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...s})});c.displayName="TableHead";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...s})});u.displayName="TableCell";let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",a),...s})});m.displayName="TableCaption"},5365:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>d,TN:()=>c,XL:()=>i});var r=a(5155),s=a(2115),l=a(2085),n=a(9434);let o=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=s.forwardRef((e,t)=>{let{className:a,variant:s,...l}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(o({variant:s}),a),...l})});d.displayName="Alert";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...s})});i.displayName="AlertTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...s})});c.displayName="AlertDescription"},5669:(e,t,a)=>{Promise.resolve().then(a.bind(a,9721))},6104:(e,t,a)=>{"use strict";let r,s,l;a.d(t,{db:()=>l,j2:()=>s});var n=a(3915),o=a(3004),d=a(5317);try{r=(0,n.Dk)().length?(0,n.Sx)():(0,n.Wp)({apiKey:"AIzaSyAkP18VtzDihlYGJYJoNsH48v83yHobkds",authDomain:"payroll-3582c.firebaseapp.com",projectId:"payroll-3582c",storageBucket:"payroll-3582c.firebasestorage.app",messagingSenderId:"595764753966",appId:"1:595764753966:web:33c2371bf504e8985e91bf",measurementId:"G-9TSQDML6N1"}),s=(0,o.xI)(r),l=(0,d.aU)(r)}catch(e){throw console.error("Firebase initialization error",e),Error("Failed to initialize Firebase. Please check your .env.local file and restart the server.")}},6695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>i,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>o,wL:()=>u});var r=a(5155),s=a(2115),l=a(9434);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});n.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...s})});o.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});d.displayName="CardTitle";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})});i.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...s})});u.displayName="CardFooter"},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>m});var r=a(2115);let s=0,l=new Map,n=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],i={toasts:[]};function c(e){i=o(i,e),d.forEach(e=>{e(i)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=r.useState(i);return r.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},7600:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,AuthProvider:()=>i});var r=a(5155),s=a(2115),l=a(3004),n=a(6104),o=a(8856);let d=s.createContext(void 0);function i(e){let{children:t}=e,[a,i]=s.useState(null),[c,u]=s.useState(!0);return(s.useEffect(()=>{let e=(0,l.hg)(n.j2,e=>{i(e),u(!1)},e=>{console.error("Auth state change error:",e),u(!1)});return()=>e()},[]),c)?(0,r.jsx)("div",{className:"flex h-screen w-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"w-1/2 space-y-4",children:[(0,r.jsx)(o.E,{className:"h-12 w-full"}),(0,r.jsx)(o.E,{className:"h-32 w-full"}),(0,r.jsx)(o.E,{className:"h-32 w-full"})]})}):(0,r.jsx)(d.Provider,{value:{user:a,loading:c},children:t})}function c(){let e=s.useContext(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7759:(e,t,a)=>{"use strict";a.d(t,{C5:()=>g,MJ:()=>x,Rr:()=>y,eI:()=>h,lR:()=>f,lV:()=>i,zB:()=>u});var r=a(5155),s=a(2115),l=a(9708),n=a(2177),o=a(9434),d=a(5057);let i=n.Op,c=s.createContext({}),u=e=>{let{...t}=e;return(0,r.jsx)(c.Provider,{value:{name:t.name},children:(0,r.jsx)(n.xI,{...t})})},m=()=>{let e=s.useContext(c),t=s.useContext(p),{getFieldState:a,formState:r}=(0,n.xW)(),l=a(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:o}=t;return{id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...l}},p=s.createContext({}),h=s.forwardRef((e,t)=>{let{className:a,...l}=e,n=s.useId();return(0,r.jsx)(p.Provider,{value:{id:n},children:(0,r.jsx)("div",{ref:t,className:(0,o.cn)("space-y-2",a),...l})})});h.displayName="FormItem";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e,{error:l,formItemId:n}=m();return(0,r.jsx)(d.J,{ref:t,className:(0,o.cn)(l&&"text-destructive",a),htmlFor:n,...s})});f.displayName="FormLabel";let x=s.forwardRef((e,t)=>{let{...a}=e,{error:s,formItemId:n,formDescriptionId:o,formMessageId:d}=m();return(0,r.jsx)(l.DX,{ref:t,id:n,"aria-describedby":s?"".concat(o," ").concat(d):"".concat(o),"aria-invalid":!!s,...a})});x.displayName="FormControl";let y=s.forwardRef((e,t)=>{let{className:a,...s}=e,{formDescriptionId:l}=m();return(0,r.jsx)("p",{ref:t,id:l,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})});y.displayName="FormDescription";let g=s.forwardRef((e,t)=>{var a;let{className:s,children:l,...n}=e,{error:d,formMessageId:i}=m(),c=d?String(null!=(a=null==d?void 0:d.message)?a:""):l;return c?(0,r.jsx)("p",{ref:t,id:i,className:(0,o.cn)("text-sm font-medium text-destructive",s),...n,children:c}):null});g.displayName="FormMessage"},8539:(e,t,a)=>{"use strict";a.d(t,{T:()=>n});var r=a(5155),s=a(2115),l=a(9434);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});n.displayName="Textarea"},8856:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var r=a(5155),s=a(9434);function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",t),...a})}},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var r=a(2596),s=a(9688);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},9721:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var r=a(5155),s=a(2115),l=a(5695),n=a(3013),o=a(6874),d=a.n(o),i=a(221),c=a(2177),u=a(5594),m=a(285),p=a(7759),h=a(2523),f=a(6695),x=a(7481),y=a(8376),g=a(3422),b=a(4063),j=a(1949),v=a(172),N=a(9119),w=a(5127),A=a(2346),k=a(5365),C=a(9434),P=a(547);let R=P.bL,S=P.l9,H=s.forwardRef((e,t)=>{let{className:a,align:s="center",sideOffset:l=4,...n}=e;return(0,r.jsx)(P.ZL,{children:(0,r.jsx)(P.UC,{ref:t,align:s,sideOffset:l,className:(0,C.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});H.displayName=P.UC.displayName;var T=a(8539),I=a(7600),O=a(5317),E=a(6104),D=a(8856);let B=u.z.object({employeeId:u.z.string(),name:u.z.string(),payRateCheck:u.z.number(),payRateOthers:u.z.coerce.number().min(0).optional(),totalHoursWorked:u.z.coerce.number().min(0,{message:"Hours must be non-negative."}).default(0),checkHours:u.z.coerce.number().min(0,{message:"Hours must be non-negative."}).default(0),otherHours:u.z.coerce.number().min(0).default(0),ptoUsed:u.z.coerce.number().min(0,{message:"PTO hours must be non-negative."}).default(0),ptoBalance:u.z.number().optional(),comment:u.z.string().optional()}).refine(e=>e.checkHours<=e.totalHoursWorked,{message:"Check hours cannot exceed total hours.",path:["checkHours"]}).refine(e=>{var t;return e.ptoUsed<=(null!=(t=e.ptoBalance)?t:0)},{message:"PTO used cannot exceed available balance.",path:["ptoUsed"]}).refine(e=>e.totalHoursWorked<=100,{message:"Hours cannot exceed company standard of ".concat(100,"."),path:["totalHoursWorked"]}),F=u.z.object({employees:u.z.array(B)}),_=[{key:"totalHoursWorked",label:"Total Hours Worked",props:{step:"0.1",min:"0"}},{key:"checkHours",label:"Check Hours",props:{step:"0.1",min:"0"}},{key:"otherHours",label:"Other Hours",props:{readOnly:!0,className:"bg-muted/50"}},{key:"ptoUsed",label:"PTO Used",props:{step:"0.1",min:"0"}}];function z(e){let{from:t,to:a,payrollId:o,initialPayrollData:d}=e,u=(0,l.useRouter)(),{toast:P}=(0,x.dj)(),{user:B}=(0,I.A)(),[z,L]=s.useState(!0),[M,V]=s.useState(!1),[W,G]=s.useState([]),[U,J]=s.useState(!1),[Z,$]=s.useState("My Small Business"),[X,Y]=s.useState(""),[Q,K]=s.useState(""),[q,ee]=s.useState(""),et=!!o,ea=(0,c.mN)({resolver:(0,i.u)(F),defaultValues:{employees:[]},mode:"onChange"}),{fields:er}=(0,c.jz)({control:ea.control,name:"employees"}),{setValue:es,watch:el,control:en,reset:eo}=ea,ed=el("employees");s.useEffect(()=>{B&&(async()=>{let e;L(!0);let t=(0,O.H9)(E.db,"users",B.uid),a=await (0,O.x7)(t);a.exists()&&$(a.data().companyName||"My Small Business");let r=(0,O.rJ)(E.db,"users",B.uid,"employees"),s=(0,O.P)(r,(0,O.My)("lastName","asc")),l=(await (0,O.GG)(s)).docs.map(e=>({id:e.id,...e.data()}));if(et&&d){e=d.inputs.map(e=>{let t=l.find(t=>t.id===e.employeeId);return{...e,ptoBalance:t?t.ptoBalance:e.ptoBalance,comment:t?t.comment:e.comment}}),Y(d.summaryEmployee||""),K(d.summaryDeductions||""),ee(d.summaryNetPay||"");let t=new Set(d.inputs.map(e=>e.employeeId));l.filter(e=>!t.has(e.id)).forEach(t=>{var a,r,s;e.push({employeeId:t.id,name:"".concat(t.firstName," ").concat(t.lastName),payRateCheck:t.payRateCheck,payRateOthers:null!=(a=t.payRateOthers)?a:0,ptoBalance:t.ptoBalance,totalHoursWorked:null!=(r=t.standardCheckHours)?r:0,checkHours:null!=(s=t.standardCheckHours)?s:0,otherHours:0,ptoUsed:0,comment:t.comment||""})})}else e=l.map(e=>{var t,a,r;return{employeeId:e.id,name:"".concat(e.firstName," ").concat(e.lastName),payRateCheck:e.payRateCheck,payRateOthers:null!=(t=e.payRateOthers)?t:0,ptoBalance:e.ptoBalance,totalHoursWorked:null!=(a=e.standardCheckHours)?a:0,checkHours:null!=(r=e.standardCheckHours)?r:0,otherHours:0,ptoUsed:0,comment:e.comment||""}});eo({employees:e}),L(!1)})()},[B,eo,et,d]),s.useEffect(()=>{let e=el((e,t)=>{let{name:a}=t;if(a&&(a.endsWith(".totalHoursWorked")||a.endsWith(".checkHours"))){let t=a.match(/^employees\.(\d+)\./);if(t){var r;let a=parseInt(t[1],10),s=null==(r=e.employees)?void 0:r[a];if(s){let e=Math.max(0,(Number(s.totalHoursWorked)||0)-(Number(s.checkHours)||0));es("employees.".concat(a,".otherHours"),e,{shouldValidate:!0})}}}});return()=>e.unsubscribe()},[el,es]);let ei=e=>{let t=Number(e);return isNaN(t)?0:t},ec=(e,t)=>{let a=parseFloat(t);G(t=>t.map(t=>{if(t.employeeId===e){let e=isNaN(a)?0:a,r=t.payRateOthers*t.otherHours;return{...t,otherAdjustment:e,grossOtherAmount:r+e}}return t}))};async function eu(){if(!B)return void P({title:"Not Authenticated",variant:"destructive"});V(!0);let e=ea.getValues().employees;try{let r=W.reduce((e,t)=>e+t.grossCheckAmount+t.grossOtherAmount,0),s={fromDate:(0,n.GP)(t,"yyyy-MM-dd"),toDate:(0,n.GP)(a,"yyyy-MM-dd"),totalAmount:r,status:"Completed",results:W,inputs:e,summaryEmployee:X,summaryDeductions:Q,summaryNetPay:q},l=o;if(et&&o){let e=(0,O.H9)(E.db,"users",B.uid,"payrolls",o);await (0,O.mZ)(e,s)}else{let e=(0,O.rJ)(E.db,"users",B.uid,"payrolls");l=(await (0,O.gS)(e,s)).id}let d=(0,O.wP)(E.db);W.forEach(e=>{let t=(0,O.H9)(E.db,"users",B.uid,"employees",e.employeeId);d.update(t,{ptoBalance:e.newPtoBalance})}),await d.commit(),sessionStorage.setItem("payrollResultsData",JSON.stringify(W)),sessionStorage.setItem("payrollPeriodData",JSON.stringify({from:t,to:a})),sessionStorage.setItem("payrollInputData",JSON.stringify(e)),sessionStorage.setItem("companyName",Z),sessionStorage.setItem("payrollSummaryData",JSON.stringify({employee:X,deductions:Q,netPay:q})),P({title:"Payroll ".concat(et?"Updated":"Approved"),description:"Payroll history saved and PTO balances updated. Redirecting to report..."}),u.push("/dashboard/payroll/report?id=".concat(l))}catch(e){console.error("Failed to approve payroll:",e),P({title:"Error ".concat(et?"Updating":"Approving"," Payroll"),description:"Could not save this payroll run. Please try again.",variant:"destructive"})}finally{V(!1)}}let em=e=>"number"!=typeof e||isNaN(e)?"$ ---.--":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),ep=e=>{let t=Number(e);return null==e||isNaN(t)?"0.00":t.toFixed(2)};return z?(0,r.jsxs)(f.Zp,{children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsxs)(f.ZB,{className:"flex items-center",children:[(0,r.jsx)(g.A,{className:"mr-2 h-5 w-5 text-muted-foreground"})," 2. Calculate Payroll"]}),(0,r.jsx)(f.BT,{children:"Loading employee data..."})]}),(0,r.jsx)(f.Wu,{className:"py-10",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(D.E,{className:"h-10 w-full"}),(0,r.jsx)(D.E,{className:"h-10 w-full"}),(0,r.jsx)(D.E,{className:"h-10 w-full"})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.Zp,{children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsxs)(f.ZB,{className:"flex items-center",children:[(0,r.jsx)(g.A,{className:"mr-2 h-5 w-5 text-muted-foreground"})," 2. Calculate Payroll"]}),(0,r.jsx)(f.BT,{children:"Enter hours and review comments for each employee for the current pay period."})]}),(0,r.jsx)(f.Wu,{children:(0,r.jsx)(p.lV,{...ea,children:(0,r.jsxs)("form",{onSubmit:ea.handleSubmit(function(e){G(e.employees.map(e=>{var t;let a,r=ei(e.totalHoursWorked),s=ei(e.checkHours),l=ei(e.otherHours),n=ei(e.ptoUsed),o=ei(e.payRateCheck),i=null!=(t=ei(e.payRateOthers))?t:0,c=ei(e.ptoBalance);if(et&&d){let t=d.inputs.find(t=>t.employeeId===e.employeeId);a=c+(t?ei(t.ptoUsed):0)-n}else a=c-n;let u=o*s+o*n;return{employeeId:e.employeeId,name:e.name,totalHoursWorked:r,checkHours:s,otherHours:l,ptoUsed:n,payRateCheck:o,payRateOthers:i,otherAdjustment:0,grossCheckAmount:u,grossOtherAmount:i*l+0,netPay:u,newPtoBalance:a}})),J(!0),P({title:"Payroll Calculated",description:"Review the results below. Finalize by approving.",variant:"default",action:(0,r.jsx)(y.A,{className:"h-4 w-4 text-white"})})}),className:"space-y-6",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(w.XI,{children:[(0,r.jsx)(w.A0,{children:(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nd,{className:"font-bold min-w-[200px]",children:"Metric"}),er.map(e=>(0,r.jsx)(w.nd,{className:"text-right",children:e.name},e.id))]})}),(0,r.jsxs)(w.BF,{children:[_.map(e=>(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nA,{className:"font-medium",children:e.label}),er.map((t,a)=>(0,r.jsx)(w.nA,{className:"text-right p-2",children:(0,r.jsx)(p.zB,{control:ea.control,name:"employees.".concat(a,".").concat(e.key),render:a=>{let{field:s}=a;return(0,r.jsxs)(p.eI,{children:[(0,r.jsxs)(p.lR,{className:"sr-only",children:[e.label," for ",t.name]}),(0,r.jsx)(p.MJ,{children:(0,r.jsx)(h.p,{type:"number",placeholder:"0",...s,...e.props,className:"h-8 w-28 text-right mx-auto"})}),(0,r.jsx)(p.C5,{className:"text-xs mt-1"})]})}})},t.id))]},e.key)),(0,r.jsxs)(w.Hj,{className:"bg-muted/20 hover:bg-muted/20",children:[(0,r.jsx)(w.nA,{className:"font-medium",children:"Available PTO"}),er.map((e,t)=>{var a;return(0,r.jsxs)(w.nA,{className:"text-center text-sm text-muted-foreground tabular-nums",children:["(",ep(null==(a=ed[t])?void 0:a.ptoBalance),")"]},e.id)})]}),(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nA,{className:"font-medium",children:"Comments"}),er.map((e,t)=>(0,r.jsx)(w.nA,{className:"text-center",children:(0,r.jsxs)(R,{children:[(0,r.jsx)(S,{asChild:!0,children:(0,r.jsxs)(m.$,{variant:"outline",size:"sm",children:[(0,r.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"View/Edit"]})}),(0,r.jsx)(H,{className:"w-80",children:(0,r.jsx)(p.zB,{control:en,name:"employees.".concat(t,".comment"),render:t=>{var a;let{field:s}=t;return(0,r.jsxs)(p.eI,{className:"grid gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium leading-none",children:"Comment"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Internal note for ",e.name,"."]})]}),(0,r.jsx)(p.MJ,{children:(0,r.jsx)(T.T,{...s,value:null!=(a=s.value)?a:""})}),(0,r.jsx)(p.C5,{})]})}})})]})},e.id))]}),0===er.length&&(0,r.jsx)(w.Hj,{children:(0,r.jsx)(w.nA,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No active employees found. Please add an employee first."})})]})]})}),ea.formState.errors.employees&&(0,r.jsxs)(k.Fc,{variant:"destructive",children:[(0,r.jsx)(j.A,{className:"h-4 w-4"}),(0,r.jsx)(k.XL,{children:"Error"}),(0,r.jsx)(k.TN,{children:"Please check the form for errors. Total or PTO hours may be invalid."})]}),(0,r.jsxs)(m.$,{type:"submit",disabled:0===er.length||ea.formState.isSubmitting,className:"w-full bg-accent text-accent-foreground hover:bg-accent/90",children:[(0,r.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Calculate Payroll"]})]})})})]}),U&&(()=>{let e={grossCheckAmount:W.reduce((e,t)=>e+t.grossCheckAmount,0),grossOtherAmount:W.reduce((e,t)=>e+t.grossOtherAmount,0),netPay:W.reduce((e,t)=>e+t.netPay,0),otherAdjustment:W.reduce((e,t)=>e+t.otherAdjustment,0)},s=[{label:"Total Hours",getValue:e=>ep(e.totalHoursWorked)},{label:"Check Hours",getValue:e=>ep(e.checkHours)},{label:"Other Hours",getValue:e=>ep(e.otherHours)},{label:"PTO Time",getValue:e=>"(".concat(ep(e.ptoUsed),")")},{type:"separator",label:"",getValue:()=>""},{label:"Rate/Check",getValue:e=>em(e.payRateCheck)+"/hr"},{label:"Rate/Others",getValue:e=>em(e.payRateOthers)+"/hr"},{label:"Others-ADJ $",getValue:e=>e.otherAdjustment},{type:"separator",label:"",getValue:()=>""},{label:"Gross Check Amount",getValue:e=>em(e.grossCheckAmount),isBold:!0},{label:"Gross Other Amount",getValue:e=>em(e.grossOtherAmount),isBold:!0},{type:"separator",label:"",getValue:()=>""},{label:"New PTO Balance",getValue:e=>"(".concat(ep(e.newPtoBalance),")")}];return(0,r.jsxs)(f.Zp,{className:"mt-6",children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsx)(f.ZB,{children:"Review Payroll Results"}),(0,r.jsxs)(f.BT,{children:["Pay Period: ",(0,n.GP)(t,"LLL dd, y")," - ",(0,n.GP)(a,"LLL dd, y")]})]}),(0,r.jsxs)(f.Wu,{children:[(0,r.jsxs)(k.Fc,{variant:"default",className:"mb-4 bg-blue-50 border-blue-200",children:[(0,r.jsx)(y.A,{className:"h-4 w-4 text-primary"}),(0,r.jsx)(k.XL,{className:"text-primary",children:"Calculation Complete"}),(0,r.jsx)(k.TN,{children:'Review the payroll details below. Click "Approve" to finalize.'})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(w.XI,{className:"w-auto",children:[(0,r.jsx)(w.A0,{children:(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nd,{className:"font-bold min-w-[200px]",children:"Metric"}),W.map(e=>(0,r.jsx)(w.nd,{className:"text-right",children:e.name},e.employeeId))]})}),(0,r.jsx)(w.BF,{children:s.map((e,t)=>"separator"===e.type?(0,r.jsx)(w.Hj,{className:"bg-muted/20 hover:bg-muted/20",children:(0,r.jsx)(w.nA,{colSpan:W.length+1,className:"h-2 p-0"})},"sep-".concat(t)):(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nA,{className:(0,C.cn)("font-medium",e.isBold&&"font-bold"),children:e.label}),W.map(t=>(0,r.jsx)(w.nA,{className:(0,C.cn)("text-right tabular-nums",{"font-semibold":e.isBold,"text-destructive":e.isDestructive},"Others-ADJ $"===e.label&&"p-2"),children:"Others-ADJ $"===e.label?(0,r.jsx)(h.p,{type:"number",step:"0.01",value:t.otherAdjustment,onChange:e=>ec(t.employeeId,e.target.value),className:"h-8 w-28 text-right"}):e.getValue(t)},t.employeeId))]},e.label))})]})}),(0,r.jsx)(A.w,{className:"my-6"}),(0,r.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Payroll Summary"}),(0,r.jsx)("div",{className:"overflow-x-auto border rounded-lg",children:(0,r.jsxs)(w.XI,{children:[(0,r.jsx)(w.A0,{children:(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nd,{children:"GP"}),(0,r.jsx)(w.nd,{children:"EMPLOYEE"}),(0,r.jsx)(w.nd,{children:"DED:"}),(0,r.jsx)(w.nd,{children:"NET"}),(0,r.jsx)(w.nd,{children:"Others"})]})}),(0,r.jsx)(w.BF,{children:(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nA,{className:"font-semibold tabular-nums",children:em(e.grossCheckAmount)}),(0,r.jsx)(w.nA,{children:(0,r.jsx)(h.p,{placeholder:"Enter value...",value:X,onChange:e=>Y(e.target.value)})}),(0,r.jsx)(w.nA,{children:(0,r.jsx)(h.p,{placeholder:"Enter value...",value:Q,onChange:e=>K(e.target.value)})}),(0,r.jsx)(w.nA,{children:(0,r.jsx)(h.p,{placeholder:"Enter value...",value:q,onChange:e=>ee(e.target.value)})}),(0,r.jsx)(w.nA,{className:"font-semibold tabular-nums",children:em(e.grossOtherAmount)})]})})]})}),(0,r.jsx)("div",{className:"mt-6 flex justify-end space-x-2",children:(0,r.jsx)(m.$,{onClick:eu,disabled:M,children:M?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4 animate-spin"})," Approving..."]}):et?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Update and View Report"]}):"Approve and View Report"})})]})]})})()]})}var L=a(2543),M=a(1920),V=a(965),W=a(3158),G=a(2181);function U(e){let{className:t,classNames:a,showOutsideDays:s=!0,...l}=e;return(0,r.jsx)(G.hv,{showOutsideDays:s,className:(0,C.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,C.cn)((0,m.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,C.cn)((0,m.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(V.A,{className:(0,C.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(W.A,{className:(0,C.cn)("h-4 w-4",t),...a})}},...l})}U.displayName="Calendar";var J=a(5057);function Z(){let{user:e}=(0,I.A)(),t=(0,l.useSearchParams)().get("id"),[a,o]=s.useState(),[i,c]=s.useState(),[u,p]=s.useState(null),[h,x]=s.useState(!!t),[y,b]=s.useState(!0),[j,N]=s.useState([]),w=!!t;s.useEffect(()=>{if(!e||w)return void b(!1);(async()=>{b(!0);try{let t=(0,O.rJ)(E.db,"users",e.uid,"payrolls"),a=(0,O.P)(t),r=(await (0,O.GG)(a)).docs.map(e=>{let t=e.data(),[a,r,s]=t.fromDate.split("-").map(Number),[l,n,o]=t.toDate.split("-").map(Number);return{from:new Date(a,r-1,s),to:new Date(l,n-1,o)}});N(r)}catch(e){console.error("Error fetching payroll ranges:",e)}finally{b(!1)}})()},[e,w]),s.useEffect(()=>{if(t&&e){x(!0);let a=(0,O.H9)(E.db,"users",e.uid,"payrolls",t);(0,O.x7)(a).then(e=>{if(e.exists()){let t={id:e.id,...e.data()};p(t);let[a,r,s]=t.fromDate.split("-").map(Number),[l,n,d]=t.toDate.split("-").map(Number);o(new Date(a,r-1,s)),c(new Date(l,n-1,d))}else console.error("No such payroll document!")}).catch(e=>{console.error("Error fetching payroll:",e)}).finally(()=>{x(!1)})}else x(!1)},[t,e]);let A=e=>{if(w)return!1;for(let t of j)if(e>=t.from&&e<=t.to)return!0;return!1};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(m.$,{variant:"outline",asChild:!0,className:"w-fit",children:(0,r.jsxs)(d(),{href:"/dashboard/payroll",children:[(0,r.jsx)(L.A,{className:"mr-2 h-4 w-4"})," Back to Payroll History"]})}),(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:w?"Edit Payroll":"Run New Payroll"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:w?"Editing payroll for period: ".concat(u?(0,n.GP)(a,"LLL dd, y")+" - "+(0,n.GP)(i,"LLL dd, y"):"..."):"Calculate employee payroll for a specific period."})]})}),h||y?(0,r.jsxs)(f.Zp,{children:[(0,r.jsx)(f.aR,{children:(0,r.jsx)(f.ZB,{children:"Loading Payroll Data..."})}),(0,r.jsx)(f.Wu,{children:(0,r.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,r.jsx)(v.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.Zp,{children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsx)(f.ZB,{children:"1. Pay Period"}),(0,r.jsx)(f.BT,{children:w?"The pay period for this run is locked.":"Choose the date range for this payroll run. Previously used dates are disabled."})]}),(0,r.jsx)(f.Wu,{children:(0,r.jsxs)("div",{className:"flex flex-wrap items-end gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(J.J,{htmlFor:"from-date",children:"From"}),(0,r.jsxs)(R,{children:[(0,r.jsx)(S,{asChild:!0,children:(0,r.jsxs)(m.$,{id:"from-date",variant:"outline",className:(0,C.cn)("w-[240px] justify-start text-left font-normal",!a&&"text-muted-foreground"),disabled:w,children:[(0,r.jsx)(M.A,{className:"mr-2 h-4 w-4"}),a?(0,n.GP)(a,"LLL dd, y"):(0,r.jsx)("span",{children:"Pick a start date"})]})}),(0,r.jsx)(H,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(U,{mode:"single",selected:a,onSelect:o,disabled:e=>i&&e>i||e>new Date||w||A(e),initialFocus:!0})})]})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(J.J,{htmlFor:"to-date",children:"To"}),(0,r.jsxs)(R,{children:[(0,r.jsx)(S,{asChild:!0,children:(0,r.jsxs)(m.$,{id:"to-date",variant:"outline",className:(0,C.cn)("w-[240px] justify-start text-left font-normal",!i&&"text-muted-foreground"),disabled:w,children:[(0,r.jsx)(M.A,{className:"mr-2 h-4 w-4"}),i?(0,n.GP)(i,"LLL dd, y"):(0,r.jsx)("span",{children:"Pick an end date"})]})}),(0,r.jsx)(H,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(U,{mode:"single",selected:i,onSelect:c,disabled:e=>!a||e<a||e>new Date||w||A(e),initialFocus:!0})})]})]})]})})]}),a&&i?(0,r.jsx)(z,{from:a,to:i,payrollId:t,initialPayrollData:u},t||"".concat((0,n.GP)(a,"yyyy-MM-dd"),"-").concat((0,n.GP)(i,"yyyy-MM-dd"))):(0,r.jsxs)(f.Zp,{children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsxs)(f.ZB,{className:"flex items-center",children:[(0,r.jsx)(g.A,{className:"mr-2 h-5 w-5 text-muted-foreground"})," 2. Calculate Payroll"]}),(0,r.jsx)(f.BT,{children:"Enter hours for each employee for the selected pay period."})]}),(0,r.jsx)(f.Wu,{children:(0,r.jsx)("p",{className:"text-center text-muted-foreground py-10",children:"Please select a pay period above to begin."})})]})]})]})}function $(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,r.jsx)(v.A,{className:"h-8 w-8 animate-spin"})}),children:(0,r.jsx)(Z,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,416,114,874,521,263,795,13,456,441,684,358],()=>t(5669)),_N_E=e.O()}]);