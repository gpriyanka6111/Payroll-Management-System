(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{1440:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var s=a(5155),r=a(2115),l=a(5695),n=a(9328),o=a(6874),i=a.n(o),d=a(221),c=a(2177),m=a(5594),u=a(285),h=a(7759),p=a(2523),y=a(6695),x=a(7481),f=a(8376),j=a(3422),N=a(172);let v=(0,a(157).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var b=a(4063),g=a(1949),A=a(9119),k=a(5127),w=a(9100),H=a(5365),M=a(9434),S=a(9208),P=a(4636),I=a(8539),C=a(7600),O=a(5317),R=a(6104),E=a(8856),D=a(5057);let T=m.z.object({employeeId:m.z.string(),name:m.z.string(),payMethod:m.z.enum(["Hourly","Salaried"]),payRateCheck:m.z.number().optional(),payRateOthers:m.z.coerce.number().min(0).optional(),biWeeklySalary:m.z.number().optional(),totalHoursWorked:m.z.coerce.number().min(0,{message:"Hours must be non-negative."}).default(0),checkHours:m.z.coerce.number().min(0,{message:"Hours must be non-negative."}).default(0),otherHours:m.z.coerce.number().min(0).default(0),ptoUsed:m.z.coerce.number().min(0,{message:"PTO hours must be non-negative."}).default(0),ptoBalance:m.z.number().optional(),comment:m.z.string().optional()}).refine(e=>"Hourly"!==e.payMethod||e.checkHours<=e.totalHoursWorked,{message:"Check hours cannot exceed total hours.",path:["checkHours"]}).refine(e=>{var t;return e.ptoUsed<=(null!=(t=e.ptoBalance)?t:0)},{message:"PTO used cannot exceed available balance.",path:["ptoUsed"]}),W=m.z.object({employees:m.z.array(T)}),B=[{key:"totalHoursWorked",label:"Total Hours Worked",props:{step:"0.1",min:"0"}},{key:"checkHours",label:"Check Hours",props:{step:"0.1",min:"0"}},{key:"otherHours",label:"Other Hours",props:{readOnly:!0,className:"bg-muted/50"}},{key:"ptoUsed",label:"PTO Used",props:{step:"0.1",min:"0"}}];function F(e){let{from:t,to:a,payrollId:o,initialPayrollData:i}=e,m=(0,l.useRouter)(),{toast:T}=(0,x.dj)(),{user:F}=(0,C.A)(),[z,L]=r.useState(!0),[U,G]=r.useState(!1),[J,V]=r.useState(!1),[Z,_]=r.useState([]),[$,X]=r.useState(!1),[q,Y]=r.useState("My Small Business"),[K,Q]=r.useState(""),[ee,et]=r.useState(""),[ea,es]=r.useState(""),er=!!o,el=(0,c.mN)({resolver:(0,d.u)(W),defaultValues:{employees:[]},mode:"onChange"}),{fields:en}=(0,c.jz)({control:el.control,name:"employees"}),{setValue:eo,watch:ei,control:ed,reset:ec,getValues:em}=el,eu=ei("employees"),eh=r.useCallback(async e=>{if(!F||!e||0===e.length)return;G(!0),T({title:"Fetching Hours",description:"Calculating worked hours from time entries..."});let s=new Date(a);s.setHours(23,59,59,999);try{for(let a=0;a<e.length;a++){let r=e[a];if("Salaried"===r.payMethod)continue;let l=(0,O.rJ)(R.db,"users",F.uid,"employees",r.employeeId,"timeEntries"),n=(0,O.P)(l,(0,O._M)("timeIn",">=",t),(0,O._M)("timeIn","<=",s)),o=(await (0,O.GG)(n)).docs.reduce((e,t)=>{let a=t.data();if(a.timeOut){let t=(0,S.o)(a.timeOut.toDate(),a.timeIn.toDate());return e+(t>0?t:0)}return e},0)/60,i=parseFloat(o.toFixed(1));eo("employees.".concat(a,".totalHoursWorked"),i,{shouldValidate:!0,shouldDirty:!0}),eo("employees.".concat(a,".checkHours"),i,{shouldValidate:!0,shouldDirty:!0})}T({title:"Hours Fetched",description:"Total hours for hourly employees have been updated.",variant:"default"})}catch(e){console.error("Error fetching hours:",e),T({title:"Error",description:"Could not fetch hours from time entries.",variant:"destructive"})}finally{G(!1)}},[F,t,a,eo,T]);r.useEffect(()=>{F&&(async()=>{L(!0);try{let e,t=(0,O.H9)(R.db,"users",F.uid),a=await (0,O.x7)(t);a.exists()&&Y(a.data().companyName||"My Small Business");let s=(0,O.rJ)(R.db,"users",F.uid,"employees"),r=(0,O.P)(s,(0,O.My)("lastName","asc")),l=(await (0,O.GG)(r)).docs.map(e=>({id:e.id,...e.data()}));if(er&&i){e=i.inputs.map(e=>{let t=l.find(t=>t.id===e.employeeId);return{...e,ptoBalance:t?t.ptoBalance:e.ptoBalance,comment:t?t.comment:e.comment}}),Q(i.summaryEmployee||""),et(i.summaryDeductions||""),es(i.summaryNetPay||"");let t=new Set(i.inputs.map(e=>e.employeeId));l.filter(e=>!t.has(e.id)).forEach(t=>{var a,s;e.push({employeeId:t.id,name:"".concat(t.firstName," ").concat(t.lastName),payMethod:t.payMethod,payRateCheck:t.payRateCheck,payRateOthers:null!=(a=t.payRateOthers)?a:0,biWeeklySalary:null!=(s=t.biWeeklySalary)?s:0,ptoBalance:t.ptoBalance,totalHoursWorked:0,checkHours:0,otherHours:0,ptoUsed:0,comment:t.comment||""})}),ec({employees:e})}else e=l.map(e=>{var t,a;return{employeeId:e.id,name:"".concat(e.firstName," ").concat(e.lastName),payMethod:e.payMethod,payRateCheck:e.payRateCheck,payRateOthers:null!=(t=e.payRateOthers)?t:0,biWeeklySalary:null!=(a=e.biWeeklySalary)?a:0,ptoBalance:e.ptoBalance,totalHoursWorked:0,checkHours:0,otherHours:0,ptoUsed:0,comment:e.comment||""}}),ec({employees:e}),e.length>0&&await eh(e)}catch(e){console.error("Error fetching payroll data:",e),T({title:"Error",description:"Failed to load initial payroll data.",variant:"destructive"})}finally{L(!1)}})()},[F,o,i,t,a]),r.useEffect(()=>{let e=ei((e,t)=>{let{name:a}=t;if(a&&(a.endsWith(".totalHoursWorked")||a.endsWith(".checkHours"))){let t=a.match(/^employees\.(\d+)\./);if(t){var s;let a=parseInt(t[1],10),r=null==(s=e.employees)?void 0:s[a];if(r&&"Hourly"===r.payMethod){let e=Math.max(0,(Number(r.totalHoursWorked)||0)-(Number(r.checkHours)||0));eo("employees.".concat(a,".otherHours"),e,{shouldValidate:!0})}}}});return()=>e.unsubscribe()},[ei,eo]);let ep=e=>{let t=Number(e);return isNaN(t)?0:t},ey=(e,t)=>{let a=parseFloat(t);_(t=>t.map(t=>{if(t.employeeId===e&&"Hourly"===t.payMethod){let e=isNaN(a)?0:a,s=t.payRateOthers*t.otherHours;return{...t,otherAdjustment:e,grossOtherAmount:s+e}}return t}))};async function ex(){if(!F)return void T({title:"Not Authenticated",variant:"destructive"});V(!0);let e=el.getValues().employees;try{let s=Z.reduce((e,t)=>e+t.grossCheckAmount+t.grossOtherAmount,0),r={fromDate:(0,n.GP)(t,"yyyy-MM-dd"),toDate:(0,n.GP)(a,"yyyy-MM-dd"),totalAmount:s,status:"Completed",results:Z,inputs:e,summaryEmployee:K,summaryDeductions:ee,summaryNetPay:ea},l=o;if(er&&o){let e=(0,O.H9)(R.db,"users",F.uid,"payrolls",o);await (0,O.mZ)(e,r)}else{let e=(0,O.rJ)(R.db,"users",F.uid,"payrolls");l=(await (0,O.gS)(e,r)).id}let i=(0,O.wP)(R.db);Z.forEach(e=>{let t=(0,O.H9)(R.db,"users",F.uid,"employees",e.employeeId);i.update(t,{ptoBalance:e.newPtoBalance})}),await i.commit(),sessionStorage.setItem("payrollResultsData",JSON.stringify(Z)),sessionStorage.setItem("payrollPeriodData",JSON.stringify({from:t,to:a})),sessionStorage.setItem("payrollInputData",JSON.stringify(e)),sessionStorage.setItem("companyName",q),sessionStorage.setItem("payrollSummaryData",JSON.stringify({employee:K,deductions:ee,netPay:ea})),T({title:"Payroll ".concat(er?"Updated":"Approved"),description:"Payroll history saved and PTO balances updated. Redirecting to report..."}),m.push("/dashboard/payroll/report?id=".concat(l))}catch(e){console.error("Failed to approve payroll:",e),T({title:"Error ".concat(er?"Updating":"Approving"," Payroll"),description:"Could not save this payroll run. Please try again.",variant:"destructive"})}finally{V(!1)}}let ef=e=>"number"!=typeof e||isNaN(e)?"$ ---.--":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),ej=e=>{let t=Number(e);return null==e||isNaN(t)?"0.00":t.toFixed(2)};return z?(0,s.jsxs)(y.Zp,{children:[(0,s.jsxs)(y.aR,{children:[(0,s.jsxs)(y.ZB,{className:"flex items-center",children:[(0,s.jsx)(j.A,{className:"mr-2 h-5 w-5 text-muted-foreground"})," 2. Calculate Payroll"]}),(0,s.jsx)(y.BT,{children:"Loading employee data..."})]}),(0,s.jsx)(y.Wu,{className:"py-10",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.E,{className:"h-10 w-full"}),(0,s.jsx)(E.E,{className:"h-10 w-full"}),(0,s.jsx)(E.E,{className:"h-10 w-full"})]})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(y.Zp,{children:[(0,s.jsxs)(y.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(y.ZB,{className:"flex items-center",children:[(0,s.jsx)(j.A,{className:"mr-2 h-5 w-5 text-muted-foreground"})," 2. Calculate Payroll"]}),(0,s.jsx)(y.BT,{children:"Enter hours and review comments for each employee for the current pay period."})]}),!er&&(0,s.jsxs)(u.$,{variant:"outline",onClick:()=>eh(em().employees),disabled:U,children:[U?(0,s.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(v,{className:"mr-2 h-4 w-4"}),"Fetch Hours"]})]}),(0,s.jsx)(y.Wu,{children:(0,s.jsx)(h.lV,{...el,children:(0,s.jsxs)("form",{onSubmit:el.handleSubmit(function(e){_(e.employees.map(e=>{let t,a,s=ep(e.ptoUsed),r=ep(e.ptoBalance);if(er&&i){let a=i.inputs.find(t=>t.employeeId===e.employeeId);t=r+(a?ep(a.ptoUsed):0)-s}else t=r-s;if("Salaried"===e.payMethod){let t=ep(e.biWeeklySalary);a={employeeId:e.employeeId,name:e.name,payMethod:e.payMethod,totalHoursWorked:0,checkHours:0,otherHours:0,ptoUsed:s,payRateCheck:0,payRateOthers:0,biWeeklySalary:t,otherAdjustment:0,grossCheckAmount:t,grossOtherAmount:0,netPay:t}}else{var l;let t=ep(e.totalHoursWorked),r=ep(e.checkHours),n=ep(e.otherHours),o=ep(e.payRateCheck),i=null!=(l=ep(e.payRateOthers))?l:0,d=o*r+o*s;a={employeeId:e.employeeId,name:e.name,payMethod:e.payMethod,totalHoursWorked:t,checkHours:r,otherHours:n,ptoUsed:s,payRateCheck:o,payRateOthers:i,biWeeklySalary:0,otherAdjustment:0,grossCheckAmount:d,grossOtherAmount:i*n+0,netPay:d}}return{...a,newPtoBalance:t}})),X(!0),T({title:"Payroll Calculated",description:"Review the results below. Finalize by approving.",variant:"default",action:(0,s.jsx)(f.A,{className:"h-4 w-4 text-white"})})}),className:"space-y-6",children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(k.XI,{children:[(0,s.jsx)(k.A0,{children:(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nd,{className:"font-bold min-w-[200px]",children:"Metric"}),en.map(e=>(0,s.jsx)(k.nd,{className:"text-left",children:e.name},e.id))]})}),(0,s.jsxs)(k.BF,{children:[B.map(e=>(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{className:"font-medium",children:e.label}),en.map((t,a)=>{var r;let l=(null==(r=eu[a])?void 0:r.payMethod)==="Salaried";return(0,s.jsx)(k.nA,{className:"text-left p-2",children:(0,s.jsx)(h.zB,{control:el.control,name:"employees.".concat(a,".").concat(e.key),render:a=>{let{field:r}=a;return(0,s.jsxs)(h.eI,{children:[(0,s.jsxs)(h.lR,{className:"sr-only",children:[e.label," for ",t.name]}),(0,s.jsx)(h.MJ,{children:(0,s.jsx)(p.p,{type:"number",placeholder:"0",...r,...e.props,className:(0,M.cn)("h-8 w-28 text-left",l&&"bg-muted/50"),disabled:l})}),(0,s.jsx)(h.C5,{className:"text-xs mt-1"})]})}})},t.id)})]},e.key)),(0,s.jsxs)(k.Hj,{className:"bg-muted/20 hover:bg-muted/20",children:[(0,s.jsx)(k.nA,{className:"font-medium",children:"Available PTO"}),en.map((e,t)=>{var a;return(0,s.jsxs)(k.nA,{className:"text-left pl-4 text-sm text-muted-foreground tabular-nums",children:["(",ej(null==(a=eu[t])?void 0:a.ptoBalance),")"]},e.id)})]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{className:"font-medium",children:"Comments"}),en.map((e,t)=>(0,s.jsx)(k.nA,{className:"text-left",children:(0,s.jsxs)(P.AM,{children:[(0,s.jsx)(P.Wv,{asChild:!0,children:(0,s.jsxs)(u.$,{variant:"outline",size:"sm",children:[(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"View/Edit"]})}),(0,s.jsx)(P.hl,{className:"w-80",children:(0,s.jsx)(h.zB,{control:ed,name:"employees.".concat(t,".comment"),render:t=>{var a;let{field:r}=t;return(0,s.jsxs)(h.eI,{className:"grid gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-medium leading-none",children:"Comment"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Internal note for ",e.name,"."]})]}),(0,s.jsx)(h.MJ,{children:(0,s.jsx)(I.T,{...r,value:null!=(a=r.value)?a:""})}),(0,s.jsx)(h.C5,{})]})}})})]})},e.id))]}),0===en.length&&(0,s.jsx)(k.Hj,{children:(0,s.jsx)(k.nA,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No active employees found. Please add an employee first."})})]})]})}),el.formState.errors.employees&&(0,s.jsxs)(H.Fc,{variant:"destructive",children:[(0,s.jsx)(g.A,{className:"h-4 w-4"}),(0,s.jsx)(H.XL,{children:"Error"}),(0,s.jsx)(H.TN,{children:"Please check the form for errors. Total or PTO hours may be invalid."})]}),(0,s.jsx)("div",{className:"flex justify-end pt-4",children:(0,s.jsx)(u.$,{type:"submit",children:"Calculate Payroll"})})]})})})]}),$&&(0,s.jsxs)(y.Zp,{children:[(0,s.jsxs)(y.aR,{children:[(0,s.jsxs)(y.ZB,{className:"flex items-center",children:[(0,s.jsx)(f.A,{className:"mr-2 h-5 w-5 text-accent"})," 3. Review & Approve"]}),(0,s.jsx)(y.BT,{children:"Review the calculated results. Make adjustments if needed, then approve to finalize."})]}),(0,s.jsxs)(y.Wu,{children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(k.XI,{children:[(0,s.jsx)(k.A0,{children:(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nd,{className:"font-bold min-w-[200px]",children:"Metric"}),Z.map(e=>(0,s.jsx)(k.nd,{className:"text-left",children:e.name},e.employeeId))]})}),(0,s.jsxs)(k.BF,{children:[(0,s.jsx)(k.Hj,{children:(0,s.jsx)(k.nA,{colSpan:Z.length+1,className:"p-2 bg-muted/20 font-semibold text-muted-foreground",children:"Hours"})}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"Total Hours Worked"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left tabular-nums",children:"Hourly"===e.payMethod?ej(e.totalHoursWorked):"N/A"},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"Check Hours"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left tabular-nums",children:"Hourly"===e.payMethod?ej(e.checkHours):"N/A"},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"Other Hours"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left tabular-nums",children:"Hourly"===e.payMethod?ej(e.otherHours):"N/A"},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"PTO Used"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left tabular-nums",children:ej(e.ptoUsed)},e.employeeId))]}),(0,s.jsx)(k.Hj,{children:(0,s.jsx)(k.nA,{colSpan:Z.length+1,className:"p-2 bg-muted/20 font-semibold text-muted-foreground",children:"Pay"})}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"Rate/Check"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left tabular-nums",children:"Hourly"===e.payMethod?ef(e.payRateCheck):"N/A"},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"Rate/Others"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left tabular-nums",children:"Hourly"===e.payMethod?ef(e.payRateOthers):"N/A"},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"Bi-weekly Salary"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left tabular-nums",children:"Salaried"===e.payMethod?ef(e.biWeeklySalary):"N/A"},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"Others-ADJ $"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"text-left",children:(0,s.jsx)(p.p,{type:"number",step:"0.01",className:"h-8 w-28",value:e.otherAdjustment,onChange:t=>ey(e.employeeId,t.target.value),disabled:"Salaried"===e.payMethod})},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{className:"font-semibold",children:"Gross Check Amount"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"font-semibold text-left tabular-nums",children:ef(e.grossCheckAmount)},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{className:"font-semibold",children:"Gross Other Amount"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"font-semibold text-left tabular-nums",children:ef(e.grossOtherAmount)},e.employeeId))]}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{className:"font-semibold",children:"Net Pay"}),Z.map(e=>(0,s.jsx)(k.nA,{className:"font-semibold text-left tabular-nums",children:ef(e.netPay)},e.employeeId))]}),(0,s.jsx)(k.Hj,{children:(0,s.jsx)(k.nA,{colSpan:Z.length+1,className:"p-2 bg-muted/20 font-semibold text-muted-foreground",children:"PTO Balance"})}),(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nA,{children:"New PTO Balance"}),Z.map(e=>(0,s.jsxs)(k.nA,{className:"text-left tabular-nums",children:["(",ej(e.newPtoBalance),")"]},e.employeeId))]})]})]})}),(0,s.jsx)(w.w,{className:"my-6"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Payroll Summary"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)(D.J,{children:["GP ",(0,s.jsx)("span",{className:"font-bold",children:ef(Z.reduce((e,t)=>e+t.grossCheckAmount,0))})]})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(D.J,{children:"EMPLOYEE"}),(0,s.jsx)(p.p,{value:K,onChange:e=>Q(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(D.J,{children:"DED"}),(0,s.jsx)(p.p,{value:ee,onChange:e=>et(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(D.J,{children:"NET"}),(0,s.jsx)(p.p,{value:ea,onChange:e=>es(e.target.value)})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)(D.J,{children:["OTHERS ",(0,s.jsx)("span",{className:"font-bold",children:ef(Z.reduce((e,t)=>e+t.grossOtherAmount,0))})]})})]})]}),(0,s.jsx)("div",{className:"flex justify-end pt-6",children:(0,s.jsxs)(u.$,{size:"lg",className:"bg-accent text-accent-foreground hover:bg-accent/90",onClick:ex,disabled:J,children:[J?(0,s.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(A.A,{className:"mr-2 h-4 w-4"}),J?"Saving...":er?"Update & Finalize":"Approve & Finalize"]})})]})]})]})}var z=a(2543),L=a(3638),U=a(1920),G=a(5511);function J(){let{user:e}=(0,C.A)(),t=(0,l.useSearchParams)().get("id"),[a,o]=r.useState(),[d,c]=r.useState(),[m,h]=r.useState(null),[p,x]=r.useState(!!t),[f,v]=r.useState(!0),[b,g]=r.useState([]),[A,k]=r.useState(null),w=!!t;r.useEffect(()=>{if(!e||w)return void v(!1);(async()=>{v(!0);try{let t=(0,O.rJ)(R.db,"users",e.uid,"payrolls"),a=(0,O.P)(t,(0,O.My)("toDate","desc")),s=await (0,O.GG)(a),r=s.docs.map(e=>{let t=e.data(),[a,s,r]=t.fromDate.split("-").map(Number),[l,n,o]=t.toDate.split("-").map(Number);return{from:new Date(a,s-1,r),to:new Date(l,n-1,o)}});if(g(r),!s.empty){let e=s.docs[0].data(),[t,a,r]=e.fromDate.split("-").map(Number),[l,o,i]=e.toDate.split("-").map(Number),d=new Date(t,a-1,r),c=new Date(l,o-1,i);k("".concat((0,n.GP)(d,"LLL dd, y")," - ").concat((0,n.GP)(c,"LLL dd, y")))}}catch(e){console.error("Error fetching payroll data:",e)}finally{v(!1)}})()},[e,w]),r.useEffect(()=>{if(t&&e){x(!0);let a=(0,O.H9)(R.db,"users",e.uid,"payrolls",t);(0,O.x7)(a).then(e=>{if(e.exists()){let t={id:e.id,...e.data()};h(t);let[a,s,r]=t.fromDate.split("-").map(Number),[l,n,i]=t.toDate.split("-").map(Number);o(new Date(a,s-1,r)),c(new Date(l,n-1,i))}else console.error("No such payroll document!")}).catch(e=>{console.error("Error fetching payroll:",e)}).finally(()=>{x(!1)})}else x(!1)},[t,e]);let H=e=>{if(w)return!1;for(let t of b)if(e>=t.from&&e<=t.to)return!0;return!1};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(u.$,{variant:"outline",asChild:!0,className:"w-fit",children:(0,s.jsxs)(i(),{href:"/dashboard/payroll",children:[(0,s.jsx)(z.A,{className:"mr-2 h-4 w-4"})," Back to Payroll History"]})}),(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:w?"Edit Payroll":"Run New Payroll"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:w?"Editing payroll for period: ".concat(m&&a&&d?(0,n.GP)(a,"LLL dd, y")+" - "+(0,n.GP)(d,"LLL dd, y"):"..."):"Calculate employee payroll for a specific period."})]}),!w&&A&&(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"text-sm font-medium flex items-center text-muted-foreground",children:[(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4"})," Last Payroll Run"]}),(0,s.jsx)("p",{className:"text-sm font-semibold",children:A})]})]}),p||f?(0,s.jsxs)(y.Zp,{children:[(0,s.jsx)(y.aR,{children:(0,s.jsx)(y.ZB,{children:"Loading Payroll Data..."})}),(0,s.jsx)(y.Wu,{children:(0,s.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,s.jsx)(N.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(y.Zp,{children:[(0,s.jsxs)(y.aR,{children:[(0,s.jsx)(y.ZB,{children:"1. Pay Period"}),(0,s.jsx)(y.BT,{children:w?"The pay period for this run is locked.":"Choose the date range for this payroll run. Previously used dates are disabled."})]}),(0,s.jsx)(y.Wu,{children:(0,s.jsxs)("div",{className:"flex flex-wrap items-end gap-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(D.J,{htmlFor:"from-date",children:"From"}),(0,s.jsxs)(P.AM,{children:[(0,s.jsx)(P.Wv,{asChild:!0,children:(0,s.jsxs)(u.$,{id:"from-date",variant:"outline",className:(0,M.cn)("w-[240px] justify-start text-left font-normal",!a&&"text-muted-foreground"),disabled:w,children:[(0,s.jsx)(U.A,{className:"mr-2 h-4 w-4"}),a?(0,n.GP)(a,"LLL dd, y"):(0,s.jsx)("span",{children:"Pick a start date"})]})}),(0,s.jsx)(P.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(G.V,{mode:"single",selected:a,onSelect:o,disabled:e=>d&&e>d||e>new Date||w||H(e),initialFocus:!0})})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(D.J,{htmlFor:"to-date",children:"To"}),(0,s.jsxs)(P.AM,{children:[(0,s.jsx)(P.Wv,{asChild:!0,children:(0,s.jsxs)(u.$,{id:"to-date",variant:"outline",className:(0,M.cn)("w-[240px] justify-start text-left font-normal",!d&&"text-muted-foreground"),disabled:w,children:[(0,s.jsx)(U.A,{className:"mr-2 h-4 w-4"}),d?(0,n.GP)(d,"LLL dd, y"):(0,s.jsx)("span",{children:"Pick an end date"})]})}),(0,s.jsx)(P.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(G.V,{mode:"single",selected:d,onSelect:c,disabled:e=>!a||e<a||e>new Date||w||H(e),initialFocus:!0})})]})]})]})})]}),a&&d?(0,s.jsx)(F,{from:a,to:d,payrollId:t,initialPayrollData:m},t||"".concat((0,n.GP)(a,"yyyy-MM-dd"),"-").concat((0,n.GP)(d,"yyyy-MM-dd"))):(0,s.jsxs)(y.Zp,{children:[(0,s.jsxs)(y.aR,{children:[(0,s.jsxs)(y.ZB,{className:"flex items-center",children:[(0,s.jsx)(j.A,{className:"mr-2 h-5 w-5 text-muted-foreground"})," 2. Calculate Payroll"]}),(0,s.jsx)(y.BT,{children:"Enter hours for each employee for the selected pay period."})]}),(0,s.jsx)(y.Wu,{children:(0,s.jsx)("p",{className:"text-center text-muted-foreground py-10",children:"Please select a pay period above to begin."})})]})]})]})}function V(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)(N.A,{className:"h-8 w-8 animate-spin"})}),children:(0,s.jsx)(J,{})})}},3422:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},3638:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},4063:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},5669:(e,t,a)=>{Promise.resolve().then(a.bind(a,1440))},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},7759:(e,t,a)=>{"use strict";a.d(t,{C5:()=>j,MJ:()=>x,Rr:()=>f,eI:()=>p,lR:()=>y,lV:()=>d,zB:()=>m});var s=a(5155),r=a(2115),l=a(9708),n=a(2177),o=a(9434),i=a(5057);let d=n.Op,c=r.createContext({}),m=e=>{let{...t}=e;return(0,s.jsx)(c.Provider,{value:{name:t.name},children:(0,s.jsx)(n.xI,{...t})})},u=()=>{let e=r.useContext(c),t=r.useContext(h),{getFieldState:a,formState:s}=(0,n.xW)(),l=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:o}=t;return{id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...l}},h=r.createContext({}),p=r.forwardRef((e,t)=>{let{className:a,...l}=e,n=r.useId();return(0,s.jsx)(h.Provider,{value:{id:n},children:(0,s.jsx)("div",{ref:t,className:(0,o.cn)("space-y-2",a),...l})})});p.displayName="FormItem";let y=r.forwardRef((e,t)=>{let{className:a,...r}=e,{error:l,formItemId:n}=u();return(0,s.jsx)(i.J,{ref:t,className:(0,o.cn)(l&&"text-destructive",a),htmlFor:n,...r})});y.displayName="FormLabel";let x=r.forwardRef((e,t)=>{let{...a}=e,{error:r,formItemId:n,formDescriptionId:o,formMessageId:i}=u();return(0,s.jsx)(l.DX,{ref:t,id:n,"aria-describedby":r?"".concat(o," ").concat(i):"".concat(o),"aria-invalid":!!r,...a})});x.displayName="FormControl";let f=r.forwardRef((e,t)=>{let{className:a,...r}=e,{formDescriptionId:l}=u();return(0,s.jsx)("p",{ref:t,id:l,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})});f.displayName="FormDescription";let j=r.forwardRef((e,t)=>{var a;let{className:r,children:l,...n}=e,{error:i,formMessageId:d}=u(),c=i?String(null!=(a=null==i?void 0:i.message)?a:""):l;return c?(0,s.jsx)("p",{ref:t,id:d,className:(0,o.cn)("text-sm font-medium text-destructive",r),...n,children:c}):null});j.displayName="FormMessage"},8376:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8539:(e,t,a)=>{"use strict";a.d(t,{T:()=>n});var s=a(5155),r=a(2115),l=a(9434);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});n.displayName="Textarea"},8905:(e,t,a)=>{"use strict";a.d(t,{C:()=>n});var s=a(2115),r=a(6101),l=a(2712),n=e=>{let{present:t,children:a}=e,n=function(e){var t,a;let[r,n]=s.useState(),i=s.useRef({}),d=s.useRef(e),c=s.useRef("none"),[m,u]=(t=e?"mounted":"unmounted",a={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},s.useReducer((e,t)=>{let s=a[e][t];return null!=s?s:e},t));return s.useEffect(()=>{let e=o(i.current);c.current="mounted"===m?e:"none"},[m]),(0,l.N)(()=>{let t=i.current,a=d.current;if(a!==e){let s=c.current,r=o(t);e?u("MOUNT"):"none"===r||(null==t?void 0:t.display)==="none"?u("UNMOUNT"):a&&s!==r?u("ANIMATION_OUT"):u("UNMOUNT"),d.current=e}},[e,u]),(0,l.N)(()=>{if(r){var e;let t,a=null!=(e=r.ownerDocument.defaultView)?e:window,s=e=>{let s=o(i.current).includes(e.animationName);if(e.target===r&&s&&(u("ANIMATION_END"),!d.current)){let e=r.style.animationFillMode;r.style.animationFillMode="forwards",t=a.setTimeout(()=>{"forwards"===r.style.animationFillMode&&(r.style.animationFillMode=e)})}},l=e=>{e.target===r&&(c.current=o(i.current))};return r.addEventListener("animationstart",l),r.addEventListener("animationcancel",s),r.addEventListener("animationend",s),()=>{a.clearTimeout(t),r.removeEventListener("animationstart",l),r.removeEventListener("animationcancel",s),r.removeEventListener("animationend",s)}}u("ANIMATION_END")},[r,u]),{isPresent:["mounted","unmountSuspended"].includes(m),ref:s.useCallback(e=>{e&&(i.current=getComputedStyle(e)),n(e)},[])}}(t),i="function"==typeof a?a({present:n.isPresent}):s.Children.only(a),d=(0,r.s)(n.ref,function(e){var t,a;let s=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?e.ref:(r=(s=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get)&&"isReactWarning"in s&&s.isReactWarning)?e.props.ref:e.props.ref||e.ref}(i));return"function"==typeof a||n.isPresent?s.cloneElement(i,{ref:d}):null};function o(e){return(null==e?void 0:e.animationName)||"none"}n.displayName="Presence"},9100:(e,t,a)=>{"use strict";a.d(t,{w:()=>c});var s=a(5155),r=a(2115),l=a(3655),n="horizontal",o=["horizontal","vertical"],i=r.forwardRef((e,t)=>{var a;let{decorative:r,orientation:i=n,...d}=e,c=(a=i,o.includes(a))?i:n;return(0,s.jsx)(l.sG.div,{"data-orientation":c,...r?{role:"none"}:{"aria-orientation":"vertical"===c?c:void 0,role:"separator"},...d,ref:t})});i.displayName="Separator";var d=a(9434);let c=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:l=!0,...n}=e;return(0,s.jsx)(i,{ref:t,decorative:l,orientation:r,className:(0,d.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...n})});c.displayName=i.displayName},9119:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[992,416,668,873,874,263,152,328,521,31,165,441,684,358],()=>t(5669)),_N_E=e.O()}]);